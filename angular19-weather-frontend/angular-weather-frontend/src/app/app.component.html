<main class="main">
  <div class="content">
    <h2 class="subtitle">Search Todays Live Weather Forecast🌦️</h2>

    <!-- Weather Form Section -->
    <div class="weather-form-row">
      <div class="weather-form-section">
        <form #cityForm="ngForm" (ngSubmit)="fetchWeatherByCity()" autocomplete="off">
          <div class="input-row">
            <input
              type="text"
              name="city"
              [(ngModel)]="city"
              placeholder="City Name"
              class="weather-input"
              required
              pattern="^[a-zA-Z\s\-]+$"
              #cityInput="ngModel"
              (keydown.enter)="fetchWeatherByCity()"
            />
          </div>

          <div *ngIf="cityInput.invalid && cityInput.errors?.['pattern'] && (cityInput.dirty || cityInput.touched)" class="error-msg">
            Only letters, spaces, and hyphens are allowed.
          </div>

          <button type="submit" [disabled]="cityInput.invalid || isLoading" class="weather-btn">
            {{ isLoading ? 'Loading...' : 'Fetch by City' }}
          </button>
        </form>
      </div>

      <div class="weather-divider"></div>

      <div class="weather-form-section">
        <div class="input-row">
          <input
            type="number"
            [(ngModel)]="latitude"
            placeholder="Latitude"
            step="any"
            class="weather-input"
            (keydown.enter)="fetchWeatherByLatLon()"
          />
          <input
            type="number"
            [(ngModel)]="longitude"
            placeholder="Longitude"
            step="any"
            class="weather-input"
            (keydown.enter)="fetchWeatherByLatLon()"
          />
        </div>
        <button (click)="fetchWeatherByLatLon()" [disabled]="isLoading" class="weather-btn">
          {{ isLoading ? 'Loading...' : 'Fetch by Latitude/Longitude' }}
        </button>
      </div>
    </div>

    <div *ngIf="errorMsg" class="error-msg">{{ errorMsg }}</div>

    <!-- Loading Spinner -->
    <div *ngIf="isLoading" class="loader">
      <div class="spinner"></div>
    </div>

    <!-- Weather Result -->
    <div *ngIf="weather && !isLoading" class="weather-result">
      <h3>
        Current Weather of
        <span *ngIf="weather.city">{{ weather.city }}</span>
        <span *ngIf="!weather.city">({{ weather.latitude }}, {{ weather.longitude }})</span>
        <span>🕓On:{{ weather.dayName }}</span>
      </h3>

      <div class="card-container">
        <div class="weather-card" *ngIf="weather.minTempTime && weather.minTemp">
          <h4>🌡️ Min Temperature {{ weather.minTemp }} °C</h4>
          <p><strong>🕓 At: </strong> {{ weather.minTempTime | date:'shortTime' }}</p>
        </div>

        <div class="weather-card" *ngIf="weather.current_weather?.temperature">
          <h4>☀️ Current Weather {{ weather.current_weather?.temperature }} °C</h4>
          <p><strong>⚠️ {{ weather.eventForecast }} </strong></p>
          <p><strong>💨 Wind speed:</strong> {{ weather.current_weather?.windspeed }} km/h</p>
          <p><strong>🧭 Wind Direction:</strong> {{ weather.current_weather?.winddirection }}°</p>
                <div *ngIf="events.length > 0" class="event-section">
        <h4>🌦️ Forecasted Events</h4>
        <ul>
          <li *ngFor="let event of events">{{ event }}</li>
        </ul>
      </div>
        </div>

        <div class="weather-card" *ngIf="weather.maxTempTime && weather.maxTemp">
          <h4>🔥 Max Temperature {{ weather.maxTemp }} °C</h4>
          <p><strong>🕓 At: </strong> {{ weather.maxTempTime | date:'shortTime' }}</p>
        </div>
      </div>
      <!-- Hourly small cards -->
<div *ngIf="weather?.todayEntries?.length">
  <h4 style="text-align: center;">Today's Hourly Forecast of 
        <span *ngIf="weather.city">{{ weather.city }}</span>🌦️</h4>
  <div class="hourly-cards-grid">
    <div class="hour-card" *ngFor="let e of weather.todayEntries">
      <div class="hour-top">🕓 {{ e.displayTime || (e.timeIso | date:'shortTime') }}</div>
      <div class="hour-temp">🌡️ {{ e.temperature }} °C</div>
      <div class="hour-event"> {{ e.event }}</div>
    </div>
  </div>
</div>
    </div>
  </div>
</main>
<router-outlet></router-outlet>